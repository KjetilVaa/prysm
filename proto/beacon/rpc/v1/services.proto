syntax = "proto3";

package ethereum.beacon.rpc.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "proto/beacon/p2p/v1/types.proto";

service BeaconService {
  rpc WaitForChainStart(google.protobuf.Empty) returns (stream ChainStartResponse);
  rpc CanonicalHead(google.protobuf.Empty) returns (ethereum.beacon.p2p.v1.BeaconBlock);
  rpc BlockTree(google.protobuf.Empty) returns (BlockTreeResponse);
}

service AttesterService {
  rpc RequestAttestation(AttestationRequest) returns (ethereum.beacon.p2p.v1.AttestationData);
  rpc SubmitAttestation(ethereum.beacon.p2p.v1.Attestation) returns (AttestResponse);
}

service ProposerService {
  rpc RequestBlock(BlockRequest) returns (ethereum.beacon.p2p.v1.BeaconBlock);
  rpc ProposeBlock(ethereum.beacon.p2p.v1.BeaconBlock) returns (ProposeResponse);
}

service ValidatorService {
  rpc DomainData(DomainRequest) returns (DomainResponse);
  rpc WaitForActivation(ValidatorActivationRequest) returns (stream ValidatorActivationResponse);
  rpc ValidatorIndex(ValidatorIndexRequest) returns (ValidatorIndexResponse);
  rpc CommitteeAssignment(CommitteeAssignmentsRequest) returns (CommitteeAssignmentResponse);
  rpc ValidatorStatus(ValidatorIndexRequest) returns (ValidatorStatusResponse);
  rpc ValidatorPerformance(ValidatorPerformanceRequest) returns (ValidatorPerformanceResponse);
  rpc ExitedValidators(ExitedValidatorsRequest) returns (ExitedValidatorsResponse);
}

message BlockRequest {
  uint64 slot = 1;
  bytes randao_reveal = 2;
}

message ProposeResponse {
  bytes block_root = 1;
}

message AttestationRequest {
  bytes public_key = 1;
  bytes poc_bit = 2;
  uint64 slot = 3;
  uint64 shard = 4;
}

message AttestResponse {
  bytes root = 1;
}

message ValidatorPerformanceRequest {
  uint64 slot = 1;
  bytes public_key = 2;
}

message ValidatorPerformanceResponse {
  uint64 balance = 1;
  uint64 total_validators = 2;
  uint64 total_active_validators = 3;
  float average_active_validator_balance = 4;
}

message ValidatorActivationRequest {
  repeated bytes public_keys = 1;
}

message ValidatorActivationResponse {
  repeated bytes activated_public_keys = 1 [deprecated = true];

  message Status {
    bytes public_key = 1;
    ValidatorStatusResponse status = 2;
  }
  repeated Status statuses = 2;
}

message ExitedValidatorsRequest {
  repeated bytes public_keys = 1;
}

message ExitedValidatorsResponse {
  repeated bytes public_keys = 1;
}

message ChainStartResponse {
  bool started = 1;
  uint64 genesis_time = 2;
}

 enum ValidatorRole {
     UNKNOWN = 0;
     ATTESTER = 1;
     PROPOSER = 2;
}

message ValidatorIndexRequest {
  bytes public_key = 1;
}

message ValidatorIndexResponse {
  uint64 index = 1;
}

message CommitteeAssignmentsRequest {
  uint64 epoch_start = 1;
  repeated bytes public_keys = 2;
}

message CommitteeAssignmentResponse {
  repeated CommitteeAssignment assignment = 1;
  message CommitteeAssignment {
    repeated uint64 committee = 1;
    uint64 shard = 2;
    uint64 slot = 3;
    bool is_proposer = 4;
    bytes public_key = 5;
    ValidatorStatus status = 6;
  }
}

message ValidatorStatusResponse {
  ValidatorStatus status = 1;
  uint64 eth1_deposit_block_number = 2;
  uint64 deposit_inclusion_slot = 3;
  uint64 activation_epoch = 4;
  uint64 position_in_activation_queue = 5;
}

message DomainRequest {
  uint64 epoch = 1;
}

message DomainResponse {
  uint64 signature_domain = 1;
}

message BlockTreeResponse {
  repeated TreeNode tree = 1;
  message TreeNode {
    ethereum.beacon.p2p.v1.BeaconBlock block = 1;
    bytes block_root = 2;
    uint64 participated_votes = 3;
    uint64 total_votes = 4;
  }
}

enum ValidatorStatus {
  UNKNOWN_STATUS = 0;
  PENDING_ACTIVE = 1;
  ACTIVE = 2;
  INITIATED_EXIT = 3;
  WITHDRAWABLE = 4;
  EXITED = 5;
  EXITED_SLASHED = 6;
}
